services:
  db:
    image: mariadb:10.11
    environment:
      MYSQL_DATABASE: wp
      MYSQL_USER: wp
      MYSQL_PASSWORD: wp
      MYSQL_ROOT_PASSWORD: root
    volumes:
      - dbdata:/var/lib/mysql
    ports: ["3307:3306"]

  wordpress:
    build:
      context: .
      dockerfile: Dockerfile
    depends_on: [db]
    environment:
      WORDPRESS_DB_HOST: db:3306
      WORDPRESS_DB_USER: wp
      WORDPRESS_DB_PASSWORD: wp
      WORDPRESS_DB_NAME: wp
      WORDPRESS_DEBUG: "1"
      WORDPRESS_URL: "${WORDPRESS_URL}"
      WORDPRESS_CONFIG_EXTRA: |
        define('WP_DEBUG_LOG', true);
        define('WP_DEBUG_DISPLAY', false);
        define('WP_HOME', '${WORDPRESS_URL}');
        define('WP_SITEURL', '${WORDPRESS_URL}');
    volumes:
      - ./wp-content:/var/www/html/wp-content
      - ./plugins/trail-conditions-reports:/var/www/html/wp-content/plugins/trail-conditions-reports
      - ./gpx_files:/var/www/html/gpx_files
      - ./import_photos:/var/www/html/import_photos
    ports: ["8082:80"]

  phpmyadmin:
    image: phpmyadmin:latest
    depends_on: [db]
    environment:
      PMA_HOST: db
    ports: ["8081:80"]

  mailhog:
    image: mailhog/mailhog
    ports: ["8025:8025"]

volumes:
  dbdata: